global rolBsAnimButton 
try(destroyDialog rolBsAnimButton)catch()

global myFgColor
global myClickColor
global myCheckedColor ----fnGetColorTheme.ms

Global BulletConfig = execute ("@\"" + (getDir #maxData) + "\\BulletConfig.ini\"")  --é…ç½®æ–‡ä»¶è·¯å¾„
Global iniPosAnimButtonTools
Global posAnimButtonMouMove     = [0,0]
Global switchAnimButtonMouState = false
global iniAnimButtonSelected    = 1

fn fnGetColorTheme =
(
	local curColorThemeFile = colorMan.getFileName()
	if (curColorThemeFile != undefined) then
	(
		if (matchpattern curColorThemeFile pattern:"*light*") then
		(
			myfgColor    = (color 65 105 225)
			myClickColor = (color 0 139 139)
		)
		else
		(
			myfgColor    = (color 219 209 72)
			myClickColor = (color 0 255 127)
		)
	)
	else
	(
		myfgColor    = (color 219 209 72)
		myClickColor = (color 0 255 127)
	)
)
fnGetColorTheme() ----è·å–å½“å‰ä¸»é¢˜æ˜¯æ·±è‰²è¿˜æ˜¯æµ…è‰²,æ¥æ›´æ”¹æ–‡å­—é¢œè‰²

fn fnGetConfig attr nameAttrClass nameAttr valueAttr =  --è®¾ç½®åˆå§‹ä¿¡æ¯æ–¹æ³•
(
	attr = (GetINISetting BulletConfig nameAttrClass nameAttr) as string  --å…ˆæå–æ–‡ä»¶ä¸­çš„è®°å½•
	if attr == "" then attr = (execute valueAttr) else (attr = execute attr)  --åˆ¤æ–­è®°å½•ä¸ºç©ºä¸å¦å¾—åˆ°éœ€è¦çš„è®°å½•å‚æ•°
)
fn fnSaveConfig =  --å¼•ç”¨ä¸Šé¢æ–¹æ³•æå‡ºéœ€è¦çš„å‚æ•°
(----æå‡ºè„šæœ¬ä½ç½®
    iniPosAnimButtonTools = fnGetConfig iniPosAnimButtonTools "BsAnimButtonSet" "PosAnimButton" (mouse.screenpos as string)
    iniAnimButtonSelected = fnGetConfig iniAnimButtonSelected "BsAnimButtonSet" "AnimButtonSelected" "1"
)
fnSaveConfig () --åˆå§‹æ‰§è¡Œä¸€é
fn fnSetConfig =  --ä¿å­˜å‚æ•°,è„šæœ¬ä½ç½®
(
	SetINISetting BulletConfig "BsAnimButtonSet" "PosAnimButton" (iniPosAnimButtonTools as string)
)

---------------é…åˆBulletToolså·¥å…·çš„iniæ–‡ä»¶ä¿å­˜ä½ç½®ä¿¡æ¯----------------------------------

rollout rolAnimBtn1 "æ¨¡å‹"
(
    
)
rollout rolAnimBtn2 "è’™çš®"
(
    
)
rollout rolAnimBtn3 "çº¦æŸ"
(
    
)
rollout rolAnimBtn4 "åŠ¨ç”»"
(
    
)
rollout rolAnimBtn5 "ç³»ç»Ÿ"
(
    
)

arrRolAnimBtn = #(
    #("â˜˜ï¸æ¨¡å‹â˜˜ï¸",#(rolAnimBtn1)),
    #("â˜•ï¸è’™çš®â˜•ï¸",#(rolAnimBtn2)),
    #("âœœåŠ¨ç”»âœœ",#(rolAnimBtn3)),
    #("âœˆï¸ç³»ç»Ÿâœˆï¸",#(rolAnimBtn4))
)	

rcmenu RCmenuConfig
(
    menuItem mAbout "ğŸ“º miHoYo_Bullet.S"

    on mAbout picked do 
    (shellLaunch "https://space.bilibili.com/2031113" "")
)

rollout rolBsAnimButton  "BsAnimButton_v1.0"
(
    local LastSubRollout = 1

    dotNetControl dotnetTabCon "System.Windows.Forms.TabControl" height:20 width:285 align:#center pos:[0,0]
    button btnExit "âœ–" width:20 height:20 pos:[980,0]  border:false
    button btnHelp "ï¼Ÿ" width:20 height:20 pos:[960,0]  border:false
    subRollout subRolMainUI width:1000 height:85 align:#center pos:[0,20]
    
    on btnHelp pressed do 
    (shellLaunch "https://www.notion.so/bullet4869/BsKeyTools-17b5ba7c37ae45f6a69ce90f45fa0657" "")

    on dotnetTabCon Selected itm do
    (
        if LastSubRollout != (itm.TabPageIndex+1) do --å¤„ç†ç›¸åŒtabæƒ…å†µ
        (
            for subroll in arrRolAnimBtn[LastSubRollout][2] do
                removeSubRollout subRolMainUI subroll
            for subroll in arrRolAnimBtn[LastSubRollout = itm.TabPageIndex+1][2] do	
                addSubRollout subRolMainUI subroll
        ) 
    )
    
    on rolBsAnimButton open do
    (
        fnSaveConfig ()  ---------------è„šæœ¬ä½ç½®ç­‰èµ‹å€¼
		fnSetConfig ()  ----------------ä¿å­˜ä½ç½®ä¿¡æ¯åˆ°iniæ–‡ä»¶
        -- dotnetTabCon.Appearance = dotnetTabCon.Appearance.Buttons
        dotnetTabCon.dock     = dotnetTabCon.dock.Fill
        dotnetTabCon.Drawmode = dotnetTabCon.Drawmode.OwnerDrawFixed
        dotnetTabCon.SizeMode = dotnetTabCon.SizeMode.Fixed
        dotnetTabCon.ItemSize = dotNetobject "System.Drawing.Size" 70 20
        
        for aTab in arrRolAnimBtn do
        (
            dotnetTabCon.TabPages.add aTab[1]
        )
        for subroll in arrRolAnimBtn[1][2] do addSubRollout subRolMainUI subroll			
    )

	on rolBsAnimButton close do -- å…³é—­è®°å¿†æµ®åŠ¨çª—å£ä½ç½®
	(
        iniPosAnimButtonTools   = (GetDialogPos rolBsAnimButton)
		fnSetConfig ()
	)

	on rolBsAnimButton mbuttondown pos do 
	(
		try (destroydialog rolBsAnimButton) catch ()
	)

	on rolBsAnimButton lbuttondown posMou do
	(
		posAnimButtonMouMove = posMou
		switchAnimButtonMouState = on
	)

	on rolBsAnimButton lbuttonup posMou do
	(
		switchAnimButtonMouState = off
	)

	on rolBsAnimButton rbuttondown pos do 
	(
		popupMenu RCmenuConfig pos:[mouse.screenpos.x + 20,mouse.screenpos.y]
	)

	on rolBsAnimButton mouseMove pos do
	(
		if switchAnimButtonMouState == on then
		(
			SetDialogPos rolBsAnimButton (mouse.screenpos - posAnimButtonMouMove)			
		)
	)

)
-- createDialog rolBsAnimButton 1000 100 fgcolor:myFgColor menu:RCmenuConfig
if (iniPosAnimButtonTools != 0) then 
(Createdialog rolBsAnimButton 1000 85 fgcolor:myFgColor pos:iniPosAnimButtonTools style:#())
else (Createdialog rolBsAnimButton 1000 85 fgcolor:myFgColor style:#())